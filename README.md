# SigmaForage

**One Sigma rule. Every SIEM.**

SigmaForage is a CLI tool that converts [Sigma](https://github.com/SigmaHQ/sigma) detection rules into native queries for 18+ SIEM and XDR platforms. Built for **Detection Engineers**, **Threat Hunters**, and **DFIR Practitioners**—write once in Sigma, deploy everywhere.

---

## Introduction

Detection rules are often written in [Sigma](https://github.com/SigmaHQ/sigma), a generic YAML format for SIEM-agnostic detection. Each SIEM, however, speaks its own query language (Splunk SPL, Elasticsearch DSL, Azure KQL, QRadar AQL, etc.). Manually porting rules is tedious and error-prone.

**SigmaForage** bridges that gap: give it a Sigma rule and a target SIEM, and it outputs the equivalent native query using the official [sigma-cli](https://github.com/SigmaHQ/sigma-cli) and [pySigma](https://github.com/SigmaHQ/pySigma) backends. You can paste the output directly into Splunk, Elasticsearch, Microsoft Sentinel, CrowdStrike, and many others.

- **Path + SIEM:** Pass the path to your Sigma rule (file or stdin) and the SIEM you want; get back runnable queries.
- **Multi-SIEM:** Convert the same rule to Splunk, Elasticsearch, and Azure Sentinel in one command.
- **Bundled rules:** Includes 60+ Sigma rules from [SigmaHQ rules-threat-hunting](https://github.com/SigmaHQ/sigma/tree/master/rules-threat-hunting) (Windows, Linux, MacOS, Cloud, Network, Proxy) for testing and demos.

---

## Demo

### 1. Clone and install

```bash
git clone https://github.com/aakashraman/SigmaForage.git
cd SigmaForage
python3 -m venv SigmaForage
source SigmaForage/bin/activate   # Linux/macOS  |  SigmaForage\Scripts\activate on Windows
pip install -r requirements.txt
pip install -e .
# Install backends for the SIEMs you use (see --list-siem for IDs):
sigma plugin install <backend>   # e.g. splunk, elasticsearch, kusto, qradar
```

### 2. Convert a Sigma rule to Splunk

Using a bundled rule from `sigma-rules/` (from SigmaHQ threat-hunting):

```bash
sigmaforage -i sigma-rules/Windows/proc_creation_win_curl_execution.yml -s splunk --no-header
```

**Valid Splunk SPL**

```
EventID=1 Image="*\\curl.exe" OR Product="The curl executable"
```

### 3. Convert to multiple SIEMs

```bash
sigmaforage -i sigma-rules/Windows/proc_creation_win_curl_execution.yml -s splunk -s elasticsearch -s azure-sentinel
```

You get one block per SIEM; copy each into the corresponding platform.

### 4. Use your own rule path + save to file

```bash
sigmaforage -i /path/to/your/rule.yml -s splunk -o splunk_query.txt
sigmaforage --list-siem
sigmaforage --help
```

---

## Features

- **Easy CLI Usage:** Convert from the command line; path to rule + SIEM = native query.
- **18+ SIEMs:** Splunk, Elasticsearch, Azure Sentinel, QRadar, CrowdStrike, SentinelOne, LogPoint, Trellix Helix, OpenSearch, Rapid7 InsightIDR, Cortex XDR, Carbon Black, Panther, Datadog, Loki, NetWitness, Wazuh, Graylog.
- **Bundled sigma-rules:** Windows, Linux, MacOS, Cloud, Network, Proxy (~10 rules each) from SigmaHQ for testing.
- **Query validity:** Output is generated by sigma-cli and official pySigma backends.

---

## How it works (sigma-cli & pySigma)

SigmaForage does not generate SIEM queries itself. It calls **[sigma-cli](https://github.com/SigmaHQ/sigma-cli)** to build the equivalent query; sigma-cli in turn uses **pySigma** (backends and pipelines) to parse the Sigma rule and emit native SPL, KQL, AQL, etc.

- **`-s`** (e.g. `-s splunk`, `-s elasticsearch`): Target **SIEM** — which backend (and thus which query language) to use.
- **`-p`** (e.g. `-p sysmon`): **Processing pipeline** — how to map the rule's log source and fields (e.g. process_creation → Sysmon EventID 1). This is *not* "which index to search"; index/sourcetype are handled by the backend or your SIEM config.

You need the matching **backend** installed for each `-s` (e.g. `sigma plugin install splunk`) and, for Windows process rules, a pipeline like **sysmon** (e.g. `pip install pysigma-pipeline-sysmon`).

---

## Supported SIEM / XDR Platforms

| Platform              | Backend ID        |
|-----------------------|-------------------|
| Splunk                | `splunk`          |
| Elasticsearch / ELK   | `elasticsearch`   |
| Azure / Microsoft Sentinel | `azure-sentinel` |
| IBM QRadar            | `qradar`          |
| CrowdStrike           | `crowdstrike`     |
| SentinelOne           | `sentinelone`     |
| LogPoint              | `logpoint`        |
| Trellix Helix         | `trellix-helix`   |
| OpenSearch            | `opensearch`      |
| Rapid7 InsightIDR     | `rapid7-insightidr` |
| Cortex XDR            | `cortex-xdr`      |
| Carbon Black          | `carbon-black`    |
| Panther               | `panther`         |
| Datadog               | `datadog`         |
| Grafana Loki          | `loki`            |
| NetWitness            | `netwitness`      |
| Wazuh / Graylog       | `wazuh` / `graylog` (Elasticsearch backend) |

Run `sigmaforage --list-siem` for the full list and backend IDs.

---

## Requirements

- **Python 3.10+**
- **sigma-cli** (installed with SigmaForage)
- **Backends** for the SIEMs you need: `sigma plugin install splunk` (etc.) or `pip install pysigma-backend-splunk`

---

## Installation

```bash
git clone https://github.com/aakashraman/SigmaForage.git
cd SigmaForage
python3 -m venv SigmaForage
source SigmaForage/bin/activate   # Windows: SigmaForage\Scripts\activate
pip install -r requirements.txt
pip install -e .
# Install backends for the SIEMs you need (run sigmaforage --list-siem for all backend IDs):
sigma plugin install <backend>
```

Examples: `sigma plugin install splunk`, `sigma plugin install elasticsearch`, `sigma plugin install kusto` (Azure Sentinel), `sigma plugin install qradar`, etc.

Optional: install several popular backends at once:

```bash
pip install sigmaforge[backends-popular]
```

---

## Usage

| Command | Description |
|--------|-------------|
| `sigmaforage -i <rule.yml> -s splunk` | Convert rule to Splunk SPL |
| `sigmaforage -i <rule.yml> -s splunk -s elasticsearch -s azure-sentinel` | Convert to multiple SIEMs |
| `sigmaforage -i <rule.yml> -s all -o queries.txt` | Convert to all supported SIEMs, save to file |
| `sigmaforage --list-siem` | List supported SIEM platforms |
| `sigmaforage --list-pipelines` | List processing pipelines (e.g. sysmon, windows) |
| `sigmaforage --interactive` | Prompt for rule path and SIEM choice |
| `sigmaforage --help` | Show all options |

**Examples with bundled rules:**

```bash
sigmaforage -i sigma-rules/Windows/proc_creation_win_curl_execution.yml -s splunk
sigmaforage -i sigma-rules/Linux/proc_creation_lnx_curl_usage.yml -s elasticsearch
sigmaforage -i examples/sample_sigma_rule.yml -s splunk -o splunk_query.txt
```

---

## Project structure

```
SigmaForage/
├── sigmaforge/           # CLI and converter
├── sigma-rules/         # Bundled Sigma rules (Windows, Linux, MacOS, Cloud, Network, Proxy)
├── scripts/              # fetch_sigma_rules.py, validate_siem_outputs.py
├── examples/             # sample_sigma_rule.yml
├── tests/
├── README.md
├── pyproject.toml
├── requirements.txt      # pip install -r requirements.txt
└── LICENSE
```

---

## Credits

- [Sigma](https://github.com/SigmaHQ/sigma) and [SigmaHQ](https://github.com/SigmaHQ) for the rule format and ecosystem.
- [sigma-cli](https://github.com/SigmaHQ/sigma-cli) and [pySigma](https://github.com/SigmaHQ/pySigma) for conversion backends.

## License

MIT. See [LICENSE](LICENSE).
